var leaveAlert = '';
window.onbeforeunload = function() { 
	if (leaveAlert != '') {
		return leaveAlert; 
	}
}

function setLeaveAlert() {
	leaveAlert = "Az oldalon nem mentett módosítások vannak.";
	return true;
}

function resetLeaveAlert() {
	leaveAlert = '';
	return true;
}

function resultChanged(id) {
	setLeaveAlert();
	$("#"+id).addClass("result_changed");
	$(".save_button").addClass("result_changed");
}

function highlight_menuitem(item) {
	previousColor = item.style.backgroundColor;
	item.style.backgroundColor='#FFE6E6';
}
function unhighlight_menuitem(item) {
	item.style.backgroundColor=previousColor;
}
function changeRowVisibility(id) {
	var obj = document.getElementById(id);
	if(obj.style.display=='table-row') {
		obj.style.display='none';
	} else {
		obj.style.display='table-row';
	}
}

function set_group_color(id,color) {
	var i=1;
	var item = document.getElementById(id+"_"+i);
	while (item!=null) {
		item.style.backgroundColor=color;
		i = i + 1;
		item = document.getElementById(id+"_"+i);
	}
}

function highlight_feladat_sor(id){
	set_group_color(id,"#FFE6E6");
}

function unhighlight_feladat_sor(id){
	set_group_color(id,"#EAEAEA");
}

function redirect(url) {
	window.location = url;
}

function oktatoi_sor_fokusz(id) {
	$("#sor_"+id).addClass("sor_fokusz");
}

function oktatoi_sor_fokusz_le() {
	$(".sor_fokusz").removeClass("sor_fokusz");
}

function onlab_litsta_targy_valtas() {
	if ($("#targy-select").val() != "")
		window.location="/oktato/onlab/osszes/"+$("#targy-select").val();
	else
		window.location="/oktato/onlab/osszes";
}

function show_previous_comments() {
	$(".show_previous_comments").hide();
	$(".hidden_previous").show();
}

$(document).ready(function() {
	$("#gyors").keyup(function(e){ 
		var talalat = "";
		var talalat_szam = 0;
		var kereso = $("#gyors").val().toUpperCase();
		console.log(kereso);
		
		for (i=0; i<neptunok.length; i++) {
			if (neptunok[i].substr(0,kereso.length) == kereso) {
				talalat_szam = talalat_szam+1;
				talalat = neptunok[i];
			}
		}
		
		if (talalat_szam == 1) {
			$("#gyors-talalat").html(talalat);
			$("#gyors-statusz").attr("src","/images/ok16.png");
			
			var code = e.which; // recommended to use e.which
			if(code==13) {
				$("#mezo_"+talalat).focus();
				$("#mezo_"+talalat).select();
			} 
	
		} else {
			$("#gyors-talalat").html(talalat_szam+" db");
			$("#gyors-statusz").attr("src","/images/question16.png");
		}
	});
	
	$(".pont_mezo").keydown(function(event){
		if(event.keyCode == 13) {
		  event.preventDefault();
		  return false;
		}
	});
	
	$(".pont_mezo").keyup(function(e){ 
		var code = e.which; // recommended to use e.which
		if((code==45)||(e.keyCode == 13)) {
			$("#gyors").focus();
			$("#gyors").select();
			
		} 
	});
	
	tablazat_szinez();
		
});

function gyors_kitoltes() {
	$(".pont_mezo").each(function(i, obj) {
		if($(this).val()=="") {
			$(this).val($("#gyorskitoltes").val());
		}
	});
}

function filter_applications() {
	if ($("#csak_jel_igen").is(":checked")) {
		$(".nem_jelentkezett").hide();
		$(".table_index").hide();
		$(".jelentkezes_index").show();
	} else {
		$(".nem_jelentkezett").show();
		$(".table_index").show();
		$(".jelentkezes_index").hide();
	}
	tablazat_szinez();
}


function tablazat_szinez() {
	szin_id = 0;
	$(".szines_sor:visible").each(function() {
		if (szin_id == 0) {
			$(this).removeClass("bg01");
			$(this).addClass("bg02");
			szin_id = 1;
		} else {
			$(this).removeClass("bg02");
			$(this).addClass("bg01");
			szin_id = 0;
		}
	});
}

function neptun_kereso_hozzaadasa(id_lista, nev_lista) {
	$("#kereso").focus();
					
	$("#kereso").keyup(function(event){
		if(event.keyCode == 13){
			if (kijelolt != "") {
				window.location = "/admin/hallgatok/"+kijelolt;
			}
		} else {
			if (event.keyCode == 27){
				$("#kereso").val("");
			}
			neptun_keres_valtozik($("#kereso").val().trim());
		}
	});
}

function neptun_keres_valtozik(szoveg) {
	$(".kiemelt_neptun_blokk").removeClass("kiemelt_neptun_blokk");
	
	kijelolt = '';
	if (szoveg.trim().length==0) {
		$(".neptun_sor").show();
		return;
	} 
	
	$(".neptun_sor").hide();

	talalati_lista = new Array();
	keres = angol_betu(szoveg.toLowerCase());

	talalat = 0;
	for (i=0; i<nev_lista.length;i++) {
		if (nev_lista[i].search(keres)>=0) {
			$("#neptun_"+id_lista[i]).addClass("kiemelt_neptun_blokk");
			$("#neptun_"+id_lista[i]).closest('tr').show();
			
			//console.log("Talalat: "+ugyfel_nev_lista[i]);
			//console.log($("#ugyfel_blokk_"+ugyfel_id_lista[i]).attr('class'));
			
			kijelolt = id_lista[i];
			talalat++;
		}
	}
	
	if (talalat > 1) kijelolt = '';
}

function angol_betu (input) {
	var magyar_betuk  = new Array("á", "é", "í", "ó", "ö", "ő", "ú", "ü", "ű");
	var angol_betuk  = new Array("a", "e", "i", "o", "o", "o", "u", "u", "u");
	
	var output = "";
	console.log("> "+input);
	for (i = 0; i<input.length; i++) {
		console.log(input[i]);
		if (magyar_betuk.indexOf(input[i]) != -1) {
			console.log('found');
			output = output + angol_betuk[magyar_betuk.indexOf(input[i])];
		} else {
			console.log('not found');
			output = output + input[i];
		}
	}
	
	console.log("< "+output);
	return output;
}

function kviz_valaszt(kviz_id, valasz) {
        $("#valasz_kep_"+valasz).attr("src","");
        $("#valasz_kep_"+valasz).attr("src","/images/loading.gif");
        $("#nem-valaszolt").hide();
	$.ajax({
		url: "/jsg.php?op=kviz_valasz&kid="+kviz_id+"&valasz="+valasz,
		success: function(html){
                    if (html == "INVALID_REQUEST") {
                        location.reload();
                    } else {
                        $(".kviz_valasztott_valasz").removeClass("kviz_valasztott_valasz");
                        $("#valasz_"+html).addClass("kviz_valasztott_valasz");
                        $("#valasz_kep_"+valasz).attr("src","/images/kerdes.png");
                    }
		},
		error: function(xhr, ajaxOptions, thrownError){
			consle.log(thrownError);
			console.log(xhr);
			auto_update = false;
		}
	});
}

function toggle_paste_grades_box() {
	$("#paste_grades_box").toggle();
}

function import_pasted_grades() {
	$("#paste_warning").addClass("bold").addClass("red");
	
	var text = $("#paste_box").val();
	var lines = text.split(/\r?\n/);
	var remaining = "";
	for(var i=0; i<lines.length; i++) {
		var cells = lines[i].split("\t");
		if (cells.length>=2) {
			var neptun = cells[0];
			var pont = cells[1];
			
			if ($("#mezo_"+neptun).length == 0) {
				remaining = remaining + lines[i] + "\r\n";
			} else {
				$("#mezo_"+neptun).val(pont);
				resultChanged('mezo_'+neptun);
				
				if (cells.length>=3) {
					$("#mezo_"+neptun+"_imsc").val(cells[2]);
                    resultChanged('mezo_'+neptun+'_imsc');
				}
                
                if (cells.length>=3) {
					$("#mezo_"+neptun+"_szoveg").val(cells[3]);
                    resultChanged('mezo_'+neptun+'_szoveg');
				}
               
                
			}
		} else {
			remaining = remaining + lines[i] + "\r\n";
		}
	}
	
	$("#paste_box").val(remaining);
	
	
	
}